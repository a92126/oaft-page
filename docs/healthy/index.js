import{init as S}from"echarts";const{useState:f,useEffect:b,useRef:I}=React,{createRoot:k,createPortal:_}=ReactDOM,C=l=>t=>{let e,n=clearTimeout,r=setTimeout;return(...o)=>{e=(e&&n(e),r(()=>t(...o),l))}},O=()=>{const[l,t]=f([]);return b(()=>{(async()=>{const e=await fetch("https://mhcj.anod.cc:22180/services/oaft");e.ok&&t(await e.json())})()},[]),l},A=l=>{const[t,e]=f({});return b(()=>{const n=Date.now()-l;(async()=>{const r=await fetch(`https://mhcq.anod.cc:22180/healthy/oaft?from=${new Date(n).toISOString()}`);if(!r.ok){e({});return}const o=await r.json();e(Object.groupBy(o,i=>i.service))})()},[l]),t},T=l=>{if(!l||l.length<6)return{background:"var(--unabled-color)"};const t=l.sort((o,i)=>new Date(o.timestamp).valueOf()-new Date(i.timestamp).valueOf()),e=t[0].healthy?["var(--healthy-color)"]:[];let n=t[0].healthy?0:1,r=t[0].healthy?-1:0;for(let o=1;o<t.length;o++){const i=t[o],d=o*100/t.length;if(i.healthy){if(n>2){const v=r*100/t.length,u=(o-1)*100/t.length;e.push("var(--error-color) "+v.toFixed(2)+"%"),e.push("var(--error-color) "+u.toFixed(2)+"%"),e.push("var(--healthy-color)"+d.toFixed(2)+"%")}else if(n>1){const v=r*100/t.length,u=(o-1)*100/t.length;e.push("var(--danger-color) "+v.toFixed(2)+"%"),e.push("var(--danger-color) "+u.toFixed(2)+"%"),e.push("var(--healthy-color)"+d.toFixed(2)+"%")}else if(n>0){const v=r*100/t.length;e.push("var(--warning-color) "+v.toFixed(2)+"%"),e.push("var(--healthy-color)"+d.toFixed(2)+"%")}n=0}else n===0&&(r=o,e.push("var(--healthy-color)"+d.toFixed(2)+"%")),++n}if(n>2){const o=r*100/t.length;e.push("var(--error-color) "+o.toFixed(2)+"%"),e.push("var(--error-color)")}else if(n>1){const o=r*100/t.length;e.push("var(--danger-color) "+o.toFixed(2)+"%"),e.push("var(--danger-color)")}else if(n>0){const o=r*100/t.length;e.push("var(--warning-color) "+o.toFixed(2)+"%"),e.push("var(--healthy-color)")}else e.push("var(--healthy-color)");return{background:`linear-gradient(to right, ${e.join(",")})`}},E=l=>{const t=I(null),e=l.status.slice().filter(s=>s.healthy),n=e.length?e.reduce(s=>s+1,0):0,r=e.length?e.reduce((s,a)=>s+a.latency,0)/e.length:Number.POSITIVE_INFINITY,o=e.length?e.toSorted((s,a)=>s.latency-a.latency)[Math.floor(e.length/2)].latency:Number.POSITIVE_INFINITY,i=l.status.length||1,d=1500,[v,u]=f("samples");b(()=>{const s=S(t.current,"light");if(v==="samples")s.setOption({animation:!1,xAxis:{type:"time",min:"dataMin",max:"dataMax"},yAxis:{type:"value",min:0,max:15,splitLine:{lineStyle:{color:"#97999a"}}},series:[{symbolSize:4,type:"scatter",data:e.map(a=>[new Date(a.timestamp),a.latency/1e3]),color:["#676fe2"]}],grid:{left:"5%",right:"1%",top:"3%",bottom:"10%"}});else{const a=e.reduce((c,h)=>{const y=h.latency;let p;return y>=1e4?p="10":y>=5e3?p=Number(.5*Math.floor(y/500)).toFixed(1):p=Number(.1*Math.floor(y/100)).toFixed(1),c[p]=(c[p]||0)+1,c},{});a[10]=a[10]||0,a[11]=a[12]=a[13]=a[14]=a[10];const m=[...new Array(50).fill(0).map((c,h)=>Number(.1*h).toFixed(1)),...new Array(6).fill(0).map((c,h)=>Number(.5*h+5).toFixed(1))].map(c=>[c,a[c]??0]);s.setOption({animation:!1,xAxis:{type:"value",splitNumber:15},yAxis:{type:"value",splitLine:{lineStyle:{color:"#97999a"}}},series:[{type:"line",smooth:!0,data:m,color:["#676fe2"],symbol:"none",areaStyle:{}}],grid:{left:"5%",right:"1%",top:"3%",bottom:"10%"}})}return()=>{s.dispose()}},[e,v]);const w=(s,a,m)=>{const c=m==="great"?h=>a[h]<s:h=>s<a[h];return c(0)?{color:"var(--good-color)"}:c(1)?{color:"var(--warning-color)"}:c(2)?{color:"var(--danger-color)"}:{color:"var(--error-color)"}},F=s=>{window.open(s,"_blank","noopener")};let g="none";const M=C(d)((s,a)=>{g===a&&(g=s,s==="hover:1"?u("samples"):(s==="hover:2"||s==="hover:3")&&u("latency"))}),x=s=>a=>{const m=JSON.stringify([a.clientX,a.clientY]);g=m,M(s,m)},N=()=>{g="none"};return React.createElement("div",{className:"detail"},React.createElement("div",{className:"modal-title"},React.createElement("h3",null,l.service.disp),React.createElement("span",{onClick:()=>l.onExit()},React.createElement("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1.5em",height:"1.5em"},React.createElement("path",{d:"M480.426667 0h61.013333C789.546667 11.306667 1003.52 221.44 1024 468.053333v82.346667C1007.146667 798.293333 793.173333 1010.986667 544.64 1024h-62.293333C231.04 1012.48 13.866667 796.373333 0 545.493333v-72.533333C17.28 224.853333 231.893333 13.013333 480.426667 0m-165.333334 342.4c53.333333 58.666667 111.146667 112.853333 166.4 169.6-51.413333 54.4-107.946667 103.893333-157.226666 160 4.693333 9.386667 13.866667 27.946667 18.56 37.12 58.026667-53.973333 112.64-111.36 169.173333-166.613333 55.466667 54.4 109.653333 110.506667 165.973333 164.266666 7.253333-6.826667 21.973333-20.48 29.226667-27.306666-53.12-57.6-110.08-111.36-164.693333-167.466667 55.253333-56.32 112.426667-110.72 165.973333-168.533333-8.746667-6.186667-26.453333-18.346667-35.2-24.533334-52.693333 55.253333-107.093333 108.8-161.28 162.56-54.613333-53.76-108.586667-108.373333-162.773333-162.56-8.533333 5.76-25.6 17.706667-34.133334 23.466667z",fill:"#EF3822","p-id":"2710"}),React.createElement("path",{d:"M315.093333 342.4c8.533333-5.76 25.6-17.706667 34.133334-23.466667 54.186667 54.186667 108.16 108.8 162.773333 162.56 54.186667-53.76 108.586667-107.306667 161.28-162.56 8.746667 6.186667 26.453333 18.346667 35.2 24.533334-53.546667 57.813333-110.72 112.213333-165.973333 168.533333 54.613333 56.106667 111.573333 109.866667 164.693333 167.466667-7.253333 6.826667-21.973333 20.48-29.226667 27.306666-56.32-53.76-110.506667-109.866667-165.973333-164.266666-56.533333 55.253333-111.146667 112.64-169.173333 166.613333-4.693333-9.173333-13.866667-27.733333-18.56-37.12 49.28-56.106667 105.813333-105.6 157.226666-160-55.253333-56.746667-113.066667-110.933333-166.4-169.6z",fill:"#FFFFFF"})))),React.createElement("div",{className:"detail-content"},React.createElement("div",{className:"main-points"},React.createElement("div",{style:w(n/i,[.99,.95,.5],"great"),onMouseMove:x("hover:1"),onMouseLeave:N},React.createElement("div",null,"\u53EF\u7528\u6027\uFF1A"),React.createElement("div",null,Number(n*100/i).toPrecision(4),"%")),React.createElement("div",{style:w(r,[2500,5e3,15e3],"less"),onMouseMove:x("hover:2"),onMouseLeave:N},React.createElement("div",null,"\u5E73\u5747\u503C\uFF1A"),React.createElement("div",null,Number(r/1e3).toPrecision(4),"s")),React.createElement("div",{style:w(o,[2500,5e3,15e3],"less"),onMouseMove:x("hover:3"),onMouseLeave:N},React.createElement("div",null,"\u4E2D\u4F4D\u6570\uFF1A"),React.createElement("div",null,Number(o/1e3).toPrecision(4),"s"))),React.createElement("div",{className:"main-chart"},React.createElement("div",{className:"chart",ref:t}),React.createElement("div",{className:"open"},React.createElement("button",{onClick:F.bind(null,l.service.link)},"\u8BBF\u95EE\u7AD9\u70B9")))))},D=()=>{const t=O(),e=A(6048e5),[n,r]=f(""),o=i=>{r(i.name)};return React.createElement("div",{className:"status"},t.filter(i=>!i.same).map((i,d)=>React.createElement("div",{key:d,className:"service"},React.createElement("span",{className:"name"},i.disp,React.createElement("span",{onClick:o.bind(null,i),className:"link"},React.createElement("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em"},React.createElement("path",{d:"M448 128v64H192v640h640V576h64v320H128V128h320z m448 0v320h-64V236.8L467.2 601.6l-44.8-44.8L787.2 192H576V128h320z",fill:"#1831bc"}))),":"),React.createElement("span",{className:"healthy",style:T(e[i.name])}))),n&&_(React.createElement(E,{service:t.find(i=>i.name===n),status:e[n]||[],onExit:()=>r("")}),document.getElementById("modal"),n))},L=document.getElementById("app");k(L).render(React.createElement(D,null));
